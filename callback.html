<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vybe Auth Callback</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="stylesheet" href="modern-ui.css"> <!-- Add our new modern UI styles -->
    <style>
        body { display: flex; justify-content: center; align-items: center; min-height: 100vh; flex-direction: column; }
        .loading-spinner {
             border: 4px solid rgba(255, 255, 255, 0.2);
             border-left-color: var(--pink-hot);
             border-radius: 50%;
             width: 40px;
             height: 40px;
             animation: spin 1s linear infinite;
             margin-bottom: var(--space-md);
         }
         @keyframes spin { to { transform: rotate(360deg); } }
         p { color: var(--white-muted); }
    </style>
</head>
<body>
    <div class="loading-spinner"></div>
    <p>Authenticating with Spotify, please wait...</p>

    <script src="auth.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            const success = handleAuthCallback();

            if (success) {
                // Fetch user ID immediately after getting token
                await fetchAndStoreUserId();
                // Redirect to the page the user was likely trying to access, or home/my-playlists
                // For simplicity, redirecting to my-playlists.html
                window.location.replace('my-playlists.html');
            } else {
                // Handle error - maybe show a message and redirect home
                document.body.innerHTML = '<p style="color: red;">Authentication failed. Redirecting home...</p>';
                setTimeout(() => {
                    window.location.replace('index.html');
                }, 3000);            }
        });
    </script>
    <script src="modern-ui.js"></script>
</body>
</html>
